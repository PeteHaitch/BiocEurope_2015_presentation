---
title: '`GenomicTuples` and DNA methylation patterns'
author:
- name: Peter Hickey (\@PeteHaitch)
  company: Walter and Eliza Hall Institute of Medical Research
  twitter: PeteHaitch
  www: www.peterhickey.org
  github: www.github.com/PeteHaitch
date: "12 January 2015"
output: ioslides_presentation
widescreen: true
---

```{r, echo = FALSE}
knitr::opts_chunk$set(comment = ">#")
```

## Motivation {.smaller .build}

> - Analysing counts of methylation patterns at genomic tuples
> - Extracted using `methtuple` (Python [https://github.com/PeteHaitch/methtuple](https://github.com/PeteHaitch/methtuple))

__Output of `methtuple`__

```
chr     strand  pos1    pos2    pos3    MMM     MMU     MUM     MUU     UMM     UMU     UUM     UUU
chr1    +       781154  781161  781190  4       1       0       0       0       0       0       0
chr1    +       781362  781406  781455  0       0       1       1       0       0       0       0
chr1    +       781616  781720  781732  0       0       1       0       0       1       1       1
chr1    +       781616  781763  781795  0       0       0       0       1       0       0       0
chr1    +       781720  781732  781738  0       1       2       1       4       0       1       0
chr1    +       781732  781738  781763  3       0       0       1       0       2       1       0
chr1    +       781738  781763  781795  0       0       0       0       0       1       0       0
chr1    +       781738  781763  781912  0       1       0       0       0       0       0       0
chr1    +       781763  781795  781912  0       0       0       1       0       0       1       0
chr1    +       781912  781989  782013  1       0       1       1       0       0       1       0
chr1    +       781912  782013  782024  3       0       0       0       0       0       0       0
chr1    +       781989  782013  782024  2       0       3       0       3       0       3       0
chr1    +       782013  782024  782048  2       2       0       0       3       2       0       0
chr1    +       782236  782243  782268  1       0       1       0       0       1       0       0
```

## Aim {.build}

![MethPat](MethPat.png)

__Implemented in `MethylationTuples`__

* `MethylationTuples::MethPat` extends `GenomicRanges::SummarizedExperiment`

## Genomic tuples

```
chr     strand  pos1    pos2    pos3
chr1    +       781154  781161  781190
chr1    +       781362  781406  781455
chr1    +       781616  781720  781732
chr1    +       781616  781763  781795
chr1    +       781720  781732  781738
```

__Idea__

* Extend `GenomicRanges` to _genomic tuples_
* Retain a familiar interface

## `GTuples` 

```{r, message = FALSE}
library(GenomicTuples)
# Create a GTuples object with two 3-tuples
seqinfo <- Seqinfo("chr1", 1000, NA, "toy")
gt <- GTuples(seqnames = 'chr1', 
              tuples = matrix(c(1L, 5L, 5L, 10L, 10L, 20L), ncol = 3), 
              strand = "+", 
              seqinfo = seqinfo)
gt
```

## `GTuples` extends `GRanges`

```{r, eval = FALSE}
setClass("GTuples",
         contains = "GRanges",
         representation(
           internalPos = "matrixOrNULL", 
           size = "integer"),
         prototype(
           internalPos = NULL,
           size = NA_integer_)
)
```

## Useful `GTuples` methods (inherited)

```{r}
seqnames(gt)
strand(gt)
```

## Useful `GTuples` methods (new)

```{r}
size(gt)
tuples(gt)
IPD(gt) # IPD = intra-pair distances
```

## Ill-defined `GTuples` methods {.build}

* `coverage`
* `flank`, `promoters`, `resize`, `restrict`, `narrow` 
* `disjoin`, `gaps`, `isDisjoint`, `range`, `reduce`
* `mapCoords`
* `Ops`, `intersect`, `pgap`, `pintersect`, `psetdiff`, `punion`, `setdiff`, `union`, `tile`

Meaningful definitions (and pull requests) welcome!

## `GTuples` comparison

__TODO__

## `findOverlaps`-based methods

__TODO__

## `GenomicTuples` summary {.build}

A drop in replacement for `GenomicRanges` when you have genomic _tuples_ rather than _ranges_.

__Limitations__

* All tuples must have same `size`
* Room for improvement with `findOverlaps(x, y, type = 'equal')`
    + Performance
    + Not all options supported (e.g., `maxgap` and `minoverlap`)

## `MethylationTuples` {.build}

An R package for analysing, managing and visualising methylation patterns at genomic tuples.

<div class="columns-2">

__Methods__

* Epialleles
* Co-methylation

![ADS_LOR_quantile](ADS_LOR_quantile.png)

</div>

## `MethylationTuples` development {.build}
> - Add additional methods, improve documentation, and add vignette
> - `MethPat` objects become increasingly sparse as `size` increases (and as $n$ increases)
     
__12 whole-genome bisulfite-sequencing samples__

|          | `pryr::object_size(x)` | `nrow`        | Number of assays | Percentage of `NA` and $0$ values |
|----------|------------------------|---------------|------------------|------------------------------------------|
| 1-tuples | $5.9$ GB               | $56,348,522$  | $2$              | $28\%$                                   |
| 2-tuples | $20.1$ GB              | $100,586,237$ | $4$              | $80\%$                                   |
| 3-tuples | $43.3$ GB              | $109,376,348$ | $8$              | $93\%$                                   |
| 4-tuples | $80.5$ GB              | $102,625,758$ | $16$             | $97\%$                                     |

## Thanks

__Advisors__

* Terry Speed
* Peter Hall

__Coding__

* Hervé Pagès
* Martin Morgan
* Michael Lawrence

__Funding__

* Edith Moffat Travel Award

## Links

* __GitHub__: [\@PeteHaitch](https://github.com/PeteHaitch/)
    + [`GenomicTuples` (release)](http://bioconductor.org/packages/release/bioc/html/GenomicTuples.html)
    + [`GenomicTuples` (GitHub devel)](https://github.com/PeteHaitch/GenomicTuples)
    + [`MethylationTuples` (GitHub devel)](https://github.com/PeteHaitch/MethylationTuples)
* __Twitter__: [\@PeteHaitch](https://twitter.com/PeteHaitch)
